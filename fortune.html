<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Fortune | BetCloud Revolution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    
    <!-- Firebase and dependencies -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="auth.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;800&display=swap');
        body {
            font-family: 'Oxanium', sans-serif;
            background-color: #0a0a12;
            color: white;
        }
        .fortune-card {
            background: linear-gradient(135deg, rgba(255,102,0,0.1) 0%, rgba(0,0,0,0.8) 100%);
            border: 1px solid rgba(255,102,0,0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(255,102,0,0.1);
        }
        .glow-orange {
            box-shadow: 0 0 15px rgba(255,102,0,0.7);
        }
        .zodiac-icon {
            transition: all 0.3s ease;
        }
        .zodiac-icon:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px rgba(255,102,0,0.7));
        }
        .zodiac-icon.active {
            background: rgba(255,102,0,0.2);
            border: 1px solid rgba(255,102,0,0.5);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="vanta-bg" class="fixed inset-0 z-0"></div>
    
    <div class="relative z-10 container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <i data-feather="cloud" class="text-orange-500 mr-2"></i>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-orange-500 to-yellow-400 bg-clip-text text-transparent">
                    BETCLOUD FORTUNE
                </h1>
            </div>
            <a href="index.html" class="text-gray-400 hover:text-white">
                <i data-feather="x"></i>
            </a>
        </header>

        <!-- User Info - Dynamic -->
        <div id="userInfoSection" class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-lg p-4 mb-6">
            <!-- Will be populated by JavaScript -->
        </div>

        <!-- Date Display -->
        <div class="text-center mb-6">
            <div class="inline-block bg-gray-800/70 px-4 py-2 rounded-lg">
                <span id="current-date" class="font-bold text-orange-400"></span>
                <span class="text-gray-400 mx-2">|</span>
                <span id="lunar-date" class="text-gray-300"></span>
            </div>
        </div>

        <!-- Zodiac Selector -->
        <div class="grid grid-cols-4 gap-3 mb-8" id="zodiacGrid">
            <!-- Zodiac buttons will be populated by JavaScript -->
        </div>

        <!-- Fortune Card -->
        <div id="fortune-result" class="fortune-card p-6 mb-8 hidden">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 id="selected-sign" class="text-xl font-bold text-orange-400"></h2>
                    <div id="lucky-numbers" class="flex space-x-2 mt-2"></div>
                </div>
                <div id="zodiac-icon" class="text-4xl"></div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-900/50 p-4 rounded-lg">
                    <h3 class="text-sm font-bold text-orange-300 mb-2">운세</h3>
                    <p id="fortune-text" class="text-sm"></p>
                </div>
                <div class="bg-gray-900/50 p-4 rounded-lg">
                    <h3 class="text-sm font-bold text-orange-300 mb-2">베팅 운</h3>
                    <div class="flex items-center">
                        <div id="luck-meter" class="flex-1 bg-gray-700 rounded-full h-4 mr-2 overflow-hidden">
                            <div id="luck-bar" class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <span id="luck-percent" class="text-xs font-bold"></span>
                    </div>
                    <p id="betting-tip" class="text-xs mt-2"></p>
                </div>
                <div class="bg-gray-900/50 p-4 rounded-lg">
                    <h3 class="text-sm font-bold text-orange-300 mb-2">추천 게임</h3>
                    <p id="recommended-game" class="text-sm"></p>
                    <button onclick="goToRecommendedGame()" class="mt-2 bg-orange-500 hover:bg-orange-600 text-white text-xs px-3 py-1 rounded glow-orange">
                        바로가기
                    </button>
                </div>
            </div>
        </div>

        <!-- Lucky Color -->
        <div class="fortune-card p-4 mb-6">
            <h3 class="font-bold text-orange-300 mb-3">오늘의 행운의 색상</h3>
            <div class="flex justify-around">
                <div class="text-center">
                    <div id="lucky-color" class="w-12 h-12 mx-auto rounded-full mb-2 shadow-lg"></div>
                    <span id="color-name" class="text-xs"></span>
                </div>
                <div class="text-center">
                    <div id="unlucky-color" class="w-12 h-12 mx-auto rounded-full mb-2 shadow-lg"></div>
                    <span id="unlucky-color-name" class="text-xs"></span>
                </div>
            </div>
        </div>

        <!-- User Fortune History -->
        <div id="fortuneHistory" class="fortune-card p-4 mb-6 hidden">
            <h3 class="font-bold text-orange-300 mb-3">나의 포춘 기록</h3>
            <div id="historyList" class="space-y-2">
                <!-- History will be populated by JavaScript -->
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-xs text-gray-500 mt-8">
            <p>© 2023 BETCLOUD REVOLUTION</p>
            <p class="mt-1">매일 자정 업데이트</p>
        </footer>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center">
        <div class="bg-gray-800 rounded-lg p-6 flex items-center">
            <i data-feather="loader" class="w-8 h-8 text-orange-500 animate-spin mr-3"></i>
            <span>처리 중...</span>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
    apiKey: "AIzaSyAr_S6URDXWbjQ4Gh0Nw_JOeTkHA_G8Uis",
    authDomain: "cloud-casino-34cc6.firebaseapp.com",
    projectId: "cloud-casino-34cc6",
    storageBucket: "cloud-casino-34cc6.firebasestorage.app",
    messagingSenderId: "289867400095",
    appId: "1:289867400095:web:c9060c2a534225db9cf3aa"
  };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const db = firebase.firestore();
        const auth = firebase.auth();

        // Vanta.js Background
        VANTA.GLOBE({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0xff6600,
            backgroundColor: 0x0a0a12,
            size: 0.7
        });

        // Helper Functions
        function showLoading() {
            document.getElementById("loadingSpinner").classList.remove("hidden");
        }

        function hideLoading() {
            document.getElementById("loadingSpinner").classList.add("hidden");
        }

        // Update User Info
        function updateUserInfo(user) {
            const userInfoSection = document.getElementById("userInfoSection");
            
            if (user) {
                db.collection("users").doc(user.uid).get().then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        userInfoSection.innerHTML = `
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-bold text-lg">${userData.name || userData.userId} 님</h3>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">${(userData.point || 0).toLocaleString()}P</span>
                                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${(userData.balance || 0).toLocaleString()}원</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400">오늘의 포춘</div>
                                    <div class="text-sm text-orange-400" id="dailyFortuneStatus">확인하기</div>
                                </div>
                            </div>
                        `;
                    }
                });
            } else {
                userInfoSection.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-gray-400">로그인이 필요합니다</p>
                        <a href="index.html" class="text-orange-400 hover:text-orange-300 text-sm">로그인 페이지로 이동</a>
                    </div>
                `;
            }
        }

        // Set current date
        const now = new Date();
        document.getElementById('current-date').textContent = `${now.getFullYear()}년 ${now.getMonth()+1}월 ${now.getDate()}일`;
        // Simple lunar date approximation
        const lunarDates = ["1월 1일", "1월 15일", "2월 2일", "3월 3일", "4월 8일", "5월 5일", "6월 6일", "7월 7일", "8월 15일", "9월 9일", "10월 10일", "12월 30일"];
        document.getElementById('lunar-date').textContent = `음력 ${lunarDates[now.getMonth()]}`;

        // Fortune data
        const fortunes = {
            aries: {
                name: "양자리 (3/21~4/19)",
                icon: "zap",
                text: "오늘은 도전적인 하루가 될 것입니다. 새로운 베팅에 도전해보세요. 행운이 따라올 것 같습니다.",
                luck: 75,
                tip: "축구 경기에서 홈팀 승리에 베팅해보세요.",
                game: "인플레이 스포츠",
                gameUrl: "sports.html",
                color: "#FF5252",
                colorName: "열정의 빨강",
                unluckyColor: "#4DB6AC",
                unluckyColorName: "차분한 청록",
                numbers: [7, 14, 21, 28, 35]
            },
            taurus: {
                name: "황소자리 (4/20~5/20)",
                icon: "compass",
                text: "안정적인 선택이 중요한 날입니다. 큰 리스크보다는 확실한 승률에 집중하세요.",
                luck: 60,
                tip: "단폴 배팅이 유리할 수 있습니다.",
                game: "스포츠 스페셜",
                gameUrl: "sports.html",
                color: "#4CAF50",
                colorName: "풍요의 초록",
                unluckyColor: "#9C27B0",
                unluckyColorName: "불안의 보라",
                numbers: [2, 11, 20, 29, 38]
            },
            gemini: {
                name: "쌍둥이자리 (5/21~6/21)",
                icon: "git-merge",
                text: "다양한 선택지가 열리는 날입니다. 여러 게임을 분산해서 베팅해보세요.",
                luck: 80,
                tip: "믹스 배팅이 좋은 결과를 가져올 수 있습니다.",
                game: "미니게임",
                gameUrl: "minigame.html",
                color: "#FFC107",
                colorName: "지혜의 노랑",
                unluckyColor: "#795548",
                unluckyColorName: "우울의 갈색",
                numbers: [3, 12, 21, 30, 39]
            },
            cancer: {
                name: "게자리 (6/22~7/22)",
                icon: "shield",
                text: "직감이 중요한 날입니다. 본능적으로 느껴지는 배팅에 도전해보세요.",
                luck: 65,
                tip: "라이브 카지노 게임이 유리합니다.",
                game: "라이브 카지노",
                gameUrl: "casino.html",
                color: "#2196F3",
                colorName: "신뢰의 파랑",
                unluckyColor: "#FF5722",
                unluckyColorName: "충동의 주황",
                numbers: [4, 13, 22, 31, 40]
            },
            leo: {
                name: "사자자리 (7/23~8/22)",
                icon: "sun",
                text: "자신감이 넘치는 날입니다. 대담한 배팅이 성공할 가능성이 있습니다.",
                luck: 85,
                tip: "하이리스크 하이리턴 배팅을 고려해보세요.",
                game: "슬롯 머신",
                gameUrl: "slot.html",
                color: "#FF9800",
                colorName: "열정의 주황",
                unluckyColor: "#607D8B",
                unluckyColorName: "냉담의 회색",
                numbers: [5, 14, 23, 32, 41]
            },
            virgo: {
                name: "처녀자리 (8/23~9/22)",
                icon: "feather",
                text: "꼼꼼한 분석이 빛을 발하는 날입니다. 통계를仔細히 살펴보세요.",
                luck: 70,
                tip: "스포츠 분석 기반 배팅이 좋습니다.",
                game: "스포츠 배팅",
                gameUrl: "sports.html",
                color: "#9C27B0",
                colorName: "섬세의 보라",
                unluckyColor: "#FF5252",
                unluckyColorName: "분노의 빨강",
                numbers: [6, 15, 24, 33, 42]
            },
            libra: {
                name: "천칭자리 (9/23~10/22)",
                icon: "scales",
                text: "균형이 중요한 날입니다. 너무 치우치지 않은 배팅 전략을 세워보세요.",
                luck: 75,
                tip: "승무패 배팅이 적합합니다.",
                game: "E-스포츠",
                gameUrl: "esports.html",
                color: "#E91E63",
                colorName: "조화의 분홍",
                unluckyColor: "#4CAF50",
                unluckyColorName: "질투의 초록",
                numbers: [7, 16, 25, 34, 43]
            },
            scorpio: {
                name: "전갈자리 (10/23~11/21)",
                icon: "activity",
                text: "집중력이 높은 날입니다. 한 가지에 몰두하는 배팅이 좋은 결과를 가져옵니다.",
                luck: 90,
                tip: "단일 경기 하이 배당 배팅을 고려해보세요.",
                game: "스페셜 배팅",
                gameUrl: "special.html",
                color: "#F44336",
                colorName: "강렬의 빨강",
                unluckyColor: "#FFC107",
                unluckyColorName: "산만의 노랑",
                numbers: [8, 17, 26, 35, 44]
            },
            sagittarius: {
                name: "사수자리 (11/22~12/21)",
                icon: "arrow-up-right",
                text: "모험심이 높은 날입니다. 새로운 종목에 도전해보세요.",
                luck: 80,
                tip: "장기 배팅이나 퓨처스 배팅이 유리합니다.",
                game: "장기 배팅",
                gameUrl: "sports.html",
                color: "#00BCD4",
                colorName: "자유의 청록",
                unluckyColor: "#9C27B0",
                unluckyColorName: "속박의 보라",
                numbers: [9, 18, 27, 36, 45]
            },
            capricorn: {
                name: "염소자리 (12/22~1/19)",
                icon: "mountain",
                text: "인내심이 필요한 날입니다. 장기적인 관점에서 배팅을 계획하세요.",
                luck: 65,
                tip: "안정적인 로우 리스크 배팅이 좋습니다.",
                game: "카지노 테이블 게임",
                gameUrl: "casino.html",
                color: "#795548",
                colorName: "안정의 갈색",
                unluckyColor: "#2196F3",
                unluckyColorName: "변덕의 파랑",
                numbers: [10, 19, 28, 37, 46]
            },
            aquarius: {
                name: "물병자리 (1/20~2/18)",
                icon: "droplet",
                text: "독창적인 아이디어가 돋보이는 날입니다. 남다른 배팅 전략을 시도해보세요.",
                luck: 70,
                tip: "특별한 프로모션이 있는 게임을 찾아보세요.",
                game: "프로모션 게임",
                gameUrl: "promotion.html",
                color: "#03A9F4",
                colorName: "창의의 하늘",
                unluckyColor: "#FF9800",
                unluckyColorName: "고정관념의 주황",
                numbers: [11, 20, 29, 38, 47]
            },
            pisces: {
                name: "물고기자리 (2/19~3/20)",
                icon: "wind",
                text: "직관이 예민한 날입니다. 감에 의존한 배팅이 좋은 결과를 가져올 수 있습니다.",
                luck: 85,
                tip: "즉석성이 중요한 게임에 도전해보세요.",
                game: "라이브 딜러 게임",
                gameUrl: "casino.html",
                color: "#3F51B5",
                colorName: "직감의 남색",
                unluckyColor: "#4CAF50",
                unluckyColorName: "현실의 초록",
                numbers: [12, 21, 30, 39, 48]
            }
        };

        // Create zodiac grid
        const zodiacGrid = document.getElementById('zodiacGrid');
        const zodiacSigns = [
            { id: 'aries', name: '양자리', icon: 'zap', color: 'red' },
            { id: 'taurus', name: '황소자리', icon: 'compass', color: 'green' },
            { id: 'gemini', name: '쌍둥이자리', icon: 'git-merge', color: 'yellow' },
            { id: 'cancer', name: '게자리', icon: 'shield', color: 'blue' },
            { id: 'leo', name: '사자자리', icon: 'sun', color: 'orange' },
            { id: 'virgo', name: '처녀자리', icon: 'feather', color: 'purple' },
            { id: 'libra', name: '천칭자리', icon: 'scales', color: 'pink' },
            { id: 'scorpio', name: '전갈자리', icon: 'activity', color: 'red' },
            { id: 'sagittarius', name: '사수자리', icon: 'arrow-up-right', color: 'teal' },
            { id: 'capricorn', name: '염소자리', icon: 'mountain', color: 'indigo' },
            { id: 'aquarius', name: '물병자리', icon: 'droplet', color: 'cyan' },
            { id: 'pisces', name: '물고기자리', icon: 'wind', color: 'blue' }
        ];

        zodiacSigns.forEach(sign => {
            const button = document.createElement('button');
            button.className = 'zodiac-icon p-3 rounded-lg bg-gray-800/70 hover:bg-orange-500/20';
            button.onclick = () => selectZodiac(sign.id);
            button.innerHTML = `
                <i data-feather="${sign.icon}" class="mx-auto text-${sign.color}-400"></i>
                <span class="text-xs block mt-1">${sign.name}</span>
            `;
            zodiacGrid.appendChild(button);
        });

        let selectedZodiac = null;

        function selectZodiac(sign) {
            const user = auth.currentUser;
            if (!user) {
                alert("로그인이 필요합니다");
                return;
            }

            selectedZodiac = sign;
            const fortune = fortunes[sign];
            if (!fortune) return;

            // Remove active class from all buttons
            document.querySelectorAll('.zodiac-icon').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to selected button
            event.target.closest('.zodiac-icon').classList.add('active');

            // Update UI
            document.getElementById('selected-sign').textContent = fortune.name;
            document.getElementById('fortune-text').textContent = fortune.text;
            
            // Animate luck meter
            setTimeout(() => {
                document.getElementById('luck-bar').style.width = `${fortune.luck}%`;
            }, 100);
            
            document.getElementById('luck-percent').textContent = `${fortune.luck}%`;
            document.getElementById('betting-tip').textContent = fortune.tip;
            document.getElementById('recommended-game').textContent = fortune.game;
            
            // Lucky numbers
            const numbersContainer = document.getElementById('lucky-numbers');
            numbersContainer.innerHTML = '';
            fortune.numbers.forEach(num => {
                const numEl = document.createElement('span');
                numEl.className = 'bg-orange-500 text-white text-xs px-2 py-1 rounded-full';
                numEl.textContent = num;
                numbersContainer.appendChild(numEl);
            });

            // Lucky color
            document.getElementById('lucky-color').style.backgroundColor = fortune.color;
            document.getElementById('color-name').textContent = fortune.colorName;
            document.getElementById('unlucky-color').style.backgroundColor = fortune.unluckyColor;
            document.getElementById('unlucky-color-name').textContent = fortune.unluckyColorName;

            // Zodiac icon
            const iconEl = document.getElementById('zodiac-icon');
            iconEl.innerHTML = '';
            const icon = document.createElement('i');
            icon.setAttribute('data-feather', fortune.icon);
            icon.className = `text-orange-400`;
            iconEl.appendChild(icon);
            feather.replace();

            // Show result
            document.getElementById('fortune-result').classList.remove('hidden');

            // Save fortune selection
            saveFortuneSelection(user.uid, sign, fortune);
        }

        async function saveFortuneSelection(userId, sign, fortune) {
            const today = new Date().toISOString().split('T')[0];
            
            try {
                // Check if already selected today
                const existing = await db.collection("fortuneSelections")
                    .where("userId", "==", userId)
                    .where("date", "==", today)
                    .get();

                if (existing.empty) {
                    // Save new selection
                    await db.collection("fortuneSelections").add({
                        userId: userId,
                        zodiacSign: sign,
                        fortune: fortune,
                        date: today,
                        timestamp: new Date().toISOString()
                    });

                    // Update user's daily fortune status
                    document.getElementById('dailyFortuneStatus').textContent = '확인완료';
                    document.getElementById('dailyFortuneStatus').classList.add('text-green-400');
                }

                // Load fortune history
                loadFortuneHistory(userId);
            } catch (error) {
                console.error("포춘 저장 오류:", error);
            }
        }

        function loadFortuneHistory(userId) {
            const historyList = document.getElementById('historyList');
            const fortuneHistory = document.getElementById('fortuneHistory');
            
            db.collection("fortuneSelections")
                .where("userId", "==", userId)
                .orderBy("timestamp", "desc")
                .limit(5)
                .get()
                .then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        fortuneHistory.classList.remove('hidden');
                        historyList.innerHTML = '';
                        
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            const historyItem = document.createElement('div');
                            historyItem.className = 'flex justify-between items-center text-sm';
                            historyItem.innerHTML = `
                                <span>${data.zodiacSign}</span>
                                <span class="text-orange-400">${data.fortune.luck}%</span>
                                <span class="text-gray-400 text-xs">${new Date(data.timestamp).toLocaleDateString()}</span>
                            `;
                            historyList.appendChild(historyItem);
                        });
                    }
                })
                .catch((error) => {
                    console.error("포춘 기록 로드 오류:", error);
                });
        }

        function goToRecommendedGame() {
            if (!selectedZodiac) {
                alert("먼저 별자리를 선택해주세요");
                return;
            }

            const user = auth.currentUser;
            if (!user) {
                alert("로그인이 필요합니다");
                return;
            }

            const fortune = fortunes[selectedZodiac];
            if (fortune && fortune.gameUrl) {
                // In real implementation, this would navigate to the game
                alert(`${fortune.game}으로 이동합니다! (데모)`);
                
                // Log game recommendation click
                db.collection("fortuneClicks").add({
                    userId: user.uid,
                    zodiacSign: selectedZodiac,
                    recommendedGame: fortune.game,
                    timestamp: new Date().toISOString()
                });
            }
        }

        // Check today's fortune status
        function checkTodayFortuneStatus(userId) {
            const today = new Date().toISOString().split('T')[0];
            
            db.collection("fortuneSelections")
                .where("userId", "==", userId)
                .where("date", "==", today)
                .get()
                .then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        document.getElementById('dailyFortuneStatus').textContent = '확인완료';
                        document.getElementById('dailyFortuneStatus').classList.add('text-green-400');
                    }
                });
        }

        // Initialize
        feather.replace();
        auth.onAuthStateChanged((user) => {
            updateUserInfo(user);
            if (user) {
                checkTodayFortuneStatus(user.uid);
                loadFortuneHistory(user.uid);
            }
        });
    </script>
</body>
</html>